# enhance-team-members 设计文档

## Context

团队成员功能目前是一个简单的表格视图，缺乏与项目管理功能一致的交互体验。用户需要一个功能完整的成员管理界面，支持搜索、筛选、排序和完整的 CRUD 操作。

**约束条件：**
- 必须与项目列表页面的交互模式保持一致
- 必须复用现有的权限系统（`auth-store.ts`）
- 必须复用现有的状态管理（`project-store.ts`）
- 必须使用 Shadcn UI 组件库

**利益相关者：**
- 项目管理员：需要高效管理团队成员
- 普通成员：需要查看团队成员信息
- 系统管理员：需要确保权限控制正确

## Goals / Non-Goals

**Goals:**
- 提供与项目管理功能一致的交互体验
- 实现完整的成员 CRUD 操作
- 支持搜索、筛选、排序功能
- 实现严格的权限控制
- 提供即时的操作反馈

**Non-Goals:**
- 实现成员在线状态显示
- 实现成员活动日志
- 实现成员头像上传
- 实现成员导入/导出功能
- 实现成员权限的细粒度控制（已在权限系统中定义）

## Decisions

### 1. 组件复用策略

**决策：** 创建与项目列表对应的新组件，保持命名一致性

- `ProjectSearchBar` → `MemberSearchBar`
- `ProjectSortSelect` → `MemberSortSelect`
- 使用相同的 UI 组件库和样式模式

**替代方案考虑：**
- 选项 A：创建通用可复用的搜索/排序组件
  - 优点：代码复用
  - 缺点：增加复杂度，当前只有两个使用场景
- 选项 B：创建独立的成员管理组件（选中）
  - 优点：更清晰的关注点分离，便于独立修改
  - 缺点：少量代码重复

### 2. 数据过滤和排序

**决策：** 使用 React `useMemo` 进行客户端过滤和排序

**替代方案考虑：**
- 选项 A：在 store 中实现过滤和排序
  - 优点：集中管理
  - 缺点：store 变复杂，多个项目需要不同过滤条件
- 选项 B：在组件中使用 useMemo（选中）
  - 优点：简单直接，每个组件独立控制
  - 缺点：每次渲染重新计算

### 3. 权限检查集成

**决策：** 使用现有的 `usePermissionCheck` Hook

**替代方案考虑：**
- 选项 A：在每个操作前手动检查权限
  - 优点：完全控制
  - 缺点：代码重复
- 选项 B：创建权限控制的 HOC（选中）
  - 优点：统一处理，代码复用
  - 缺点：增加一层抽象

### 4. 确认对话框

**决策：** 使用统一的 `ConfirmDialog` 组件替换原生 `confirm()`

**替代方案考虑：**
- 选项 A：继续使用原生 `confirm()`
  - 优点：简单
  - 缺点：样式不一致，无法自定义
- 选项 B：使用 `ConfirmDialog`（选中）
  - 优点：统一风格，可自定义
  - 缺点：需要额外的状态管理

### 5. Toast 通知

**决策：** 使用 `sonner` 库显示所有操作反馈

**替代方案考虑：**
- 选项 A：不显示任何通知
  - 优点：简单
  - 缺点：用户不知道操作结果
- 选项 B：显示简单的控制台日志
  - 优点：便于调试
  - 缺点：用户看不到
- 选项 C：使用 sonner Toast（选中）
  - 优点：统一风格，用户友好
  - 缺点：需要安装库（已安装）

## Risks / Trade-offs

### 风险 1：过度设计

**风险：** 添加过多功能使界面复杂
**缓解措施：** 分阶段实现，先实现核心功能，可选功能（批量操作）后期考虑

### 风险 2：权限检查遗漏

**风险：** 某些操作没有权限检查
**缓解措施：** 审查所有成员相关操作，确保都调用 `canManageMembers`

### 风险 3：状态同步问题

**风险：** 本地状态与 store 状态不同步
**缓解措施：** 优先使用 store 状态，仅在 UI 相关状态使用本地 state

### 权衡 1：性能 vs 代码复杂度

- 选择客户端过滤/排序而非服务端
- 理由：当前数据量小（<100 成员），客户端足够快

### 权衡 2：功能完整性 vs 实现时间

- 暂不实现批量操作
- 理由：使用频率较低，可后续迭代添加

## Migration Plan

**迁移步骤：**
1. 创建新组件（不删除旧代码）
2. 集成新组件到 `team-members.tsx`
3. 逐步替换旧实现
4. 测试所有功能
5. 删除旧代码

**回滚计划：**
- 保留 Git 历史记录
- 每个阶段提交单独的 commit
- 如有问题可快速回滚

## Open Questions

1. **是否需要成员头像功能？**
   - 当前用户数据模型有 `avatar` 字段
   - 建议：暂不实现头像上传，使用默认头像

2. **是否需要批量操作？**
   - 批量删除、批量更改角色
   - 建议：作为可选功能，在核心功能完成后再考虑

3. **是否需要成员分组视图？**
   - 按角色分组显示成员
   - 建议：暂不需要，当前成员数量较少

4. **是否需要成员活动日志？**
   - 记录成员的添加、角色变更、移除等操作
   - 建议：暂不实现，属于审计功能，可后续添加
