# Proposal: Implement File Storage Service

## Why
当前角色图片管理存在以下问题：
1. AI 生成的图片存储在第三方服务（如智谱 AI），URL 可能过期或受限
2. "导出文件夹"功能需要实时下载远程图片，网络不稳定时容易失败
3. "更新资产"功能没有本地文件缓存，每次都需要重新获取
4. 缺少统一的文件存储管理服务，图片数据缺乏持久化保障

## What Changes
1. **创建文件存储服务**：统一管理角色相关的所有文件（图片、语音等）
2. **后台预下载机制**：AI 生成图片后自动下载到后端服务器
3. **混合存储方案**：前端 IndexedDB 缓存 + 后端服务器持久化
4. **数据库记录管理**：记录文件元数据、存储位置、关联关系
5. **优化导出流程**：导出时使用已下载的本地文件，无需实时获取

## Impact
- **file-organization** spec: 新增文件存储管理需求
- **character-design** spec: 修改图片生成流程，增加预下载逻辑
- **asset-management** spec: 关联资产文件存储

## Dependencies
- 现有上传 API (`src/lib/api/upload.ts`)
- 后端服务器存储支持
- IndexedDB 浏览器支持

## Architecture Overview
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   AI API        │───▶│  文件存储服务    │───▶│  后端服务器     │
│  (生成图片)     │    │  (预下载/缓存)   │    │  (持久化存储)   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌──────────────────┐
                       │   IndexedDB      │
                       │  (前端缓存)      │
                       └──────────────────┘
                              │
                              ▼
                       ┌──────────────────┐
                       │   导出/资产同步  │
                       │  (使用本地文件)  │
                       └──────────────────┘
```
